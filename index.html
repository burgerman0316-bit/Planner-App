<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Agenda Pro | V3.3.2</title>

    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>

    <style>
        :root {
            --bg: #000000; --card: #1c1c1e; --border: #2c2c2e; --text: #ffffff;
            --dim: #8e8e93; --accent: #ffd60a; --error: #ff375f;
            --input-bg: #1c1c1e; --icon-color: #ffffff;
            --safe-top: env(safe-area-inset-top, 20px);
            --safe-bottom: env(safe-area-inset-bottom, 20px);
        }

        /* --- THEMES --- */
        body.theme-midnight { --bg: #000; --card: #1c1c1e; --accent: #ffd60a; --icon-color: #ffd60a; }
        body.theme-solar { --bg: #1a1a1a; --card: #242424; --accent: #ffb300; --icon-color: #ffb300; }
        body.theme-cyber { --bg: #05010d; --card: #12042b; --accent: #ff00ff; --icon-color: #ff00ff; }
        body.theme-forest { --bg: #0d140e; --card: #1a241c; --accent: #5efc82; --icon-color: #5efc82; }
        body.theme-silver { --bg: #f2f2f7; --card: #ffffff; --accent: #007aff; --text: #000; --border: #d1d1d6; --input-bg: #e5e5ea; --icon-color: #007aff; }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; font-family: -apple-system, system-ui, sans-serif; }
        body { margin: 0; background: var(--bg); color: var(--text); overflow: hidden; height: 100vh; transition: 0.4s; }

        /* TUTORIAL FIXED CSS */
        #tutorial-overlay {
            position: fixed; inset: 0; z-index: 9999;
            background: inherit; /* Inherits the body theme color */
            display: none; flex-direction: column; align-items: center; justify-content: center;
            padding: 40px; text-align: center;
        }
        .tut-container { width: 100%; max-width: 400px; }
        .tut-step { display: none; }
        .tut-step.active { display: block; animation: tutFade 0.5s forwards; }
        @keyframes tutFade { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        /* SHARED UI */
        .btn-prime { 
            width: 100%; padding: 20px; border-radius: 22px; border: none; 
            font-weight: 900; text-transform: uppercase; cursor: pointer; 
            background: var(--accent); color: #000; margin-top: 20px;
        }
        .theme-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin: 25px 0; }
        .theme-btn { 
            padding: 15px; border-radius: 15px; border: 1px solid var(--border); 
            background: var(--card); color: var(--text); font-weight: 700; cursor: pointer;
        }
        
        input, select { 
            width: 100%; padding: 18px; border-radius: 18px; border: 1px solid var(--border); 
            background: var(--input-bg); color: var(--text); margin-top: 8px; font-size: 16px;
        }

        /* APP LAYOUT */
        #app-shell { display: none; flex-direction: column; height: 100vh; }
        header { padding: var(--safe-top) 25px 15px; border-bottom: 1px solid var(--border); }
        .header-top { display: flex; justify-content: space-between; align-items: center; }
        h1 { margin: 0; font-size: 32px; letter-spacing: -1.5px; }
        
        .nav-scroller { display: flex; gap: 10px; overflow-x: auto; padding: 15px 0; }
        .tab-pill { padding: 10px 20px; border-radius: 50px; background: var(--card); white-space: nowrap; font-size: 13px; font-weight: 700; border: 1px solid var(--border); }
        .tab-pill.active { background: var(--accent); color: #000; }

        main { flex: 1; overflow-y: auto; padding: 25px; padding-bottom: 200px; }
        .card { background: var(--card); padding: 20px; border-radius: 24px; border: 1px solid var(--border); margin-bottom: 12px; display: flex; justify-content: space-between; }

        #login-screen { position: fixed; inset: 0; z-index: 8888; background: #000; display: flex; align-items: center; justify-content: center; padding: 30px; }
        
        footer { position: fixed; bottom: 0; width: 100%; padding: 20px; padding-bottom: calc(var(--safe-bottom) + 15px); background: linear-gradient(transparent, var(--bg) 40%); }
    </style>
</head>
<body class="theme-midnight">

    <div id="login-screen">
        <div style="width:100%; max-width:350px; text-align:center;">
            <h1 style="font-size:50px; margin-bottom:40px;">Agenda.</h1>
            <input type="email" id="auth-email" placeholder="Email">
            <input type="password" id="auth-pass" placeholder="Password" style="margin-top:10px;">
            <button class="btn-prime" onclick="handleAuth()">Get Started</button>
            <button class="btn-prime" style="background:white; color:black; margin-top:10px;" onclick="googleSignIn()">Google Sign In</button>
        </div>
    </div>

    <div id="tutorial-overlay">
        <div class="tut-container">
            <div id="tut-1" class="tut-step active">
                <h2 style="font-size:36px; letter-spacing:-1px;">Select a Vibe.</h2>
                <p style="color:var(--dim);">Tap to preview the theme live.</p>
                <div class="theme-grid">
                    <button class="theme-btn" onclick="setTheme('theme-midnight')">Midnight</button>
                    <button class="theme-btn" onclick="setTheme('theme-solar')">Solar</button>
                    <button class="theme-btn" onclick="setTheme('theme-cyber')">Cyber</button>
                    <button class="theme-btn" onclick="setTheme('theme-forest')">Forest</button>
                    <button class="theme-btn" onclick="setTheme('theme-silver')">Silver</button>
                </div>
                <button class="btn-prime" onclick="nextTut(2)">Looks Good</button>
            </div>

            <div id="tut-2" class="tut-step">
                <h2 style="font-size:36px; letter-spacing:-1px;">First Agenda.</h2>
                <p style="color:var(--dim);">Give your main list a name.</p>
                <input type="text" id="tut-agenda-name" placeholder="e.g. My Life, University, Hustle">
                <select id="tut-agenda-type">
                    <option value="Standard">Standard</option>
                    <option value="Countdown">Countdown</option>
                    <option value="Milestone">Milestone</option>
                </select>
                <button class="btn-prime" onclick="finishTut()">Start Organizing</button>
            </div>
        </div>
    </div>

    <div id="app-shell">
        <header>
            <div class="header-top">
                <h1>Agenda</h1>
                <div style="display:flex; gap:10px;">
                    <div onclick="openModal('modal-new-list')" style="font-size:24px; cursor:pointer;">⊕</div>
                    <div onclick="openModal('modal-settings')" style="font-size:24px; cursor:pointer;">⚙️</div>
                </div>
            </div>
            <div class="nav-scroller" id="tab-bar"></div>
        </header>
        <main id="main-content"></main>
        <footer>
            <div style="background:var(--card); padding:12px; border-radius:30px; border:1px solid var(--border);">
                <div style="display:flex; gap:8px;">
                    <input type="text" id="t-input" placeholder="What's next?" style="margin:0; flex:1;">
                    <input type="date" id="d-input" style="margin:0; width:130px;">
                </div>
                <button class="btn-prime" style="margin-top:10px; padding:15px;" onclick="handleTaskSubmit()">Add Item</button>
            </div>
        </footer>
    </div>

    <div id="modal-settings" style="position:fixed; inset:0; background:rgba(0,0,0,0.8); display:none; align-items:flex-end; z-index:10000;" onclick="this.style.display='none'">
        <div style="background:var(--card); width:100%; padding:30px; border-radius:30px 30px 0 0;" onclick="event.stopPropagation()">
            <h2>Settings</h2>
            <button class="btn-prime" style="background:var(--error); color:white;" onclick="auth.signOut(); location.reload();">Log Out</button>
        </div>
    </div>

    <div id="modal-new-list" style="position:fixed; inset:0; background:rgba(0,0,0,0.8); display:none; align-items:flex-end; z-index:10000;" onclick="this.style.display='none'">
        <div style="background:var(--card); width:100%; padding:30px; border-radius:30px 30px 0 0;" onclick="event.stopPropagation()">
            <h2>New Agenda</h2>
            <input type="text" id="n-list-name" placeholder="Name">
            <button class="btn-prime" onclick="createNewAgenda()">Create</button>
        </div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyCEdkitaytyO0ZHL-bbU0R1p_oy8E1RhbY",
            authDomain: "plannerapp-ff221.firebaseapp.com",
            projectId: "plannerapp-ff221",
            storageBucket: "plannerapp-ff221.appspot.com",
            messagingSenderId: "282165391993",
            appId: "1:282165391993:web:cd1b9e50b03a68edfb9aa8"
        };
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        let activeTab = 'General';
        let allTasks = [];
        let agendas = JSON.parse(localStorage.getItem('agendas_v15')) || [{id:'General', type:'Standard'}];

        async function handleAuth() {
            const email = document.getElementById('auth-email').value;
            const pass = document.getElementById('auth-pass').value;
            try { await auth.signInWithEmailAndPassword(email, pass); } 
            catch (e) { try { await auth.createUserWithEmailAndPassword(email, pass); } catch(err) { alert(err.message); } }
        }
        function googleSignIn() { auth.signInWithPopup(new firebase.auth.GoogleAuthProvider()); }

        auth.onAuthStateChanged(user => {
            if (user) {
                document.getElementById('login-screen').style.display = 'none';
                document.getElementById('app-shell').style.display = 'flex';
                sync(user.uid);
                if (!localStorage.getItem('tut_v15_' + user.uid)) {
                    document.getElementById('tutorial-overlay').style.display = 'flex';
                }
            } else {
                document.getElementById('login-screen').style.display = 'flex';
                document.getElementById('app-shell').style.display = 'none';
            }
        });

        window.setTheme = (t) => {
            document.body.className = t;
            localStorage.setItem('theme_v15', t);
        };
        if(localStorage.getItem('theme_v15')) setTheme(localStorage.getItem('theme_v15'));

        window.nextTut = (step) => {
            document.querySelectorAll('.tut-step').forEach(s => s.classList.remove('active'));
            document.getElementById('tut-' + step).classList.add('active');
        };

        window.finishTut = () => {
            const name = document.getElementById('tut-agenda-name').value.trim();
            if (name) { agendas = [{id: name, type: document.getElementById('tut-agenda-type').value}]; activeTab = name; saveAgendas(); }
            localStorage.setItem('tut_v15_' + auth.currentUser.uid, 'true');
            document.getElementById('tutorial-overlay').style.display = 'none';
            render();
        };

        function sync(uid) {
            db.collection("tasks").where("uid", "==", uid).onSnapshot(snap => {
                allTasks = snap.docs.map(d => ({id: d.id, ...d.data()}));
                render();
            });
        }

        window.handleTaskSubmit = () => {
            const name = document.getElementById('t-input').value;
            const date = document.getElementById('d-input').value;
            if(!name || !date) return;
            db.collection("tasks").add({ name, date, category: activeTab, uid: auth.currentUser.uid });
            document.getElementById('t-input').value = '';
        };

        function saveAgendas() { localStorage.setItem('agendas_v15', JSON.stringify(agendas)); }

        window.openModal = (id) => document.getElementById(id).style.display = 'flex';
        
        window.createNewAgenda = () => {
            const n = document.getElementById('n-list-name').value;
            if(!n) return;
            agendas.push({id: n, type: 'Standard'});
            activeTab = n; saveAgendas(); render();
            document.getElementById('modal-new-list').style.display = 'none';
        };

        function render() {
            document.getElementById('tab-bar').innerHTML = agendas.map(a => `<div class="tab-pill ${a.id === activeTab ? 'active' : ''}" onclick="activeTab='${a.id}'; render();">${a.id}</div>`).join('');
            const main = document.getElementById('main-content');
            main.innerHTML = '';
            allTasks.filter(t => t.category === activeTab).forEach(t => {
                const card = document.createElement('div');
                card.className = 'card';
                card.innerHTML = `<div><b>${t.name}</b><br><small>${t.date}</small></div><div onclick="db.collection('tasks').doc('${t.id}').delete()">✕</div>`;
                main.appendChild(card);
            });
        }
    </script>
</body>
</html>
