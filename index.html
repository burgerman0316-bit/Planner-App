<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Agenda Pro | V3.3.9</title>

    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>

    <style>
        :root {
            --bg: #000000; --card: #1c1c1e; --border: #2c2c2e; --text: #ffffff;
            --dim: #8e8e93; --accent: #ffd60a; --error: #ff375f;
            --input-bg: #1c1c1e; --icon-color: #ffffff;
            /* Extra clearance for Dynamic Island */
            --safe-top: env(safe-area-inset-top, 50px); 
            --safe-bottom: env(safe-area-inset-bottom, 20px);
        }

        /* --- THEMES --- */
        body.theme-midnight { --bg: #000; --card: #1c1c1e; --accent: #ffd60a; }
        body.theme-solar { --bg: #1a1a1a; --card: #242424; --accent: #ffb300; }
        body.theme-cyber { --bg: #05010d; --card: #12042b; --accent: #ff00ff; }
        body.theme-forest { --bg: #0d140e; --card: #1a241c; --accent: #5efc82; }
        body.theme-silver { --bg: #f2f2f7; --card: #ffffff; --accent: #007aff; --text: #000; --border: #d1d1d6; --input-bg: #e5e5ea; }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; font-family: -apple-system, system-ui, sans-serif; }
        body { margin: 0; background: var(--bg); color: var(--text); overflow: hidden; height: 100vh; transition: 0.4s; }

        /* AUTH SCREEN */
        #login-screen {
            position: fixed; inset: 0; z-index: 9999; background: #000;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            padding: 40px; text-align: center;
        }
        .auth-logo { font-size: 65px; font-weight: 900; letter-spacing: -4px; margin: 0; color: #fff; }
        .auth-sub { font-size: 11px; font-weight: 900; color: #444; letter-spacing: 2px; margin-bottom: 40px; text-transform: uppercase; }

        /* UI ELEMENTS */
        .btn-prime { width: 100%; padding: 20px; border-radius: 22px; border: none; font-weight: 900; text-transform: uppercase; cursor: pointer; background: var(--accent); color: #000; margin-top: 15px; display: flex; align-items: center; justify-content: center; gap: 12px; font-size: 14px; }
        input { width: 100%; padding: 18px; border-radius: 18px; border: 1px solid var(--border); background: var(--input-bg); color: var(--text); font-size: 16px; outline: none; margin-bottom: 12px; }

        /* APP LAYOUT */
        #app-shell { display: none; flex-direction: column; height: 100vh; }
        header { padding: calc(var(--safe-top) + 20px) 25px 15px; border-bottom: 1px solid var(--border); background: var(--bg); z-index: 100; }
        .header-top { display: flex; justify-content: space-between; align-items: center; }
        h1 { margin: 0; font-size: 32px; letter-spacing: -1.5px; font-weight: 900; }
        
        .nav-scroller { display: flex; gap: 10px; overflow-x: auto; padding: 15px 0; scrollbar-width: none; }
        .tab-pill { padding: 10px 22px; border-radius: 50px; background: var(--card); white-space: nowrap; font-size: 13px; font-weight: 800; border: 1px solid var(--border); color: var(--dim); cursor: pointer; }
        .tab-pill.active { background: var(--accent); color: #000; border-color: var(--accent); }

        main { flex: 1; overflow-y: auto; padding: 25px; padding-bottom: 350px; }
        .card { background: var(--card); padding: 20px; border-radius: 24px; border: 1px solid var(--border); margin-bottom: 12px; display: flex; justify-content: space-between; align-items: center; }

        footer { position: fixed; bottom: 0; width: 100%; padding: 20px 20px calc(var(--safe-bottom) + 10px); background: linear-gradient(transparent, var(--bg) 30%); z-index: 100; }
        .entry-box { background: var(--card); padding: 20px; border-radius: 32px; border: 1px solid var(--border); box-shadow: 0 15px 40px rgba(0,0,0,0.6); }

        /* FOOTER INPUTS */
        .input-row { display: flex; gap: 10px; align-items: center; margin-top: 10px; }
        #d-input { flex: 0 0 140px; padding: 12px; font-size: 14px; margin-bottom: 0; }
        .today-btn { flex: 1; height: 45px; background: var(--border); border: none; color: var(--text); border-radius: 15px; font-weight: 800; font-size: 12px; cursor: pointer; }

        .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.85); display: none; align-items: flex-end; z-index: 10000; backdrop-filter: blur(15px); }
        .modal-sheet { background: var(--card); width: 100%; padding: 20px 25px calc(var(--safe-bottom) + 20px); border-radius: 35px 35px 0 0; border-top: 1px solid var(--border); max-height: 85vh; overflow-y: auto; }
    </style>
</head>
<body class="theme-midnight">

    <div id="login-screen">
        <h1 class="auth-logo">Agenda.</h1>
        <p class="auth-sub">Private Workspace</p>
        
        <div style="width: 100%; max-width: 340px;">
            <input type="text" id="auth-name" placeholder="Full Name">
            <input type="email" id="auth-email" placeholder="Email Address">
            <input type="password" id="auth-pass" placeholder="Password">
            
            <button class="btn-prime" onclick="handleAuth()">
                Get Started
            </button>
            
            <div style="margin: 15px 0; color: #333; font-weight: 800; font-size: 10px;">OR</div>

            <button class="btn-prime" style="background:white; color:black; margin-top:0;" onclick="googleSignIn()">
                <svg width="18" height="18" viewBox="0 0 48 48">
                    <path fill="#EA4335" d="M24 9.5c3.54 0 6.71 1.22 9.21 3.6l6.85-6.85C35.9 2.38 30.47 0 24 0 14.62 0 6.51 5.38 2.56 13.22l7.98 6.19C12.43 13.72 17.74 9.5 24 9.5z"/>
                    <path fill="#4285F4" d="M46.98 24.55c0-1.57-.15-3.09-.38-4.55H24v9.02h12.94c-.58 2.96-2.26 5.48-4.78 7.18l7.73 6c4.51-4.18 7.09-10.36 7.09-17.65z"/>
                    <path fill="#FBBC05" d="M10.53 28.59c-.48-1.45-.76-2.99-.76-4.59s.27-3.14.76-4.59l-7.98-6.19C.92 16.46 0 20.12 0 24c0 3.88.92 7.54 2.56 10.78l7.97-6.19z"/>
                    <path fill="#34A853" d="M24 48c6.48 0 11.93-2.13 15.89-5.81l-7.73-6c-2.15 1.45-4.92 2.3-8.16 2.3-6.26 0-11.57-4.22-13.47-9.91l-7.98 6.19C6.51 42.62 14.62 48 24 48z"/>
                </svg>
                Google
            </button>
        </div>
    </div>

    <div id="app-shell">
        <header>
            <div class="header-top">
                <h1>Agenda</h1>
                <div style="display:flex; gap:15px; align-items:center;">
                    <div onclick="openModal('modal-new-list')" style="font-size:30px; cursor:pointer; color:var(--accent)">+</div>
                    <div onclick="openModal('modal-settings')" style="font-size:24px; cursor:pointer;">⚙️</div>
                </div>
            </div>
            <div class="nav-scroller" id="tab-bar"></div>
        </header>

        <main id="main-content"></main>

        <footer>
            <div class="entry-box">
                <input type="text" id="t-input" placeholder="Title of event..." style="margin-bottom:0;" onkeypress="if(event.key==='Enter')handleTaskSubmit()">
                <div class="input-row">
                    <input type="date" id="d-input">
                    <button class="today-btn" onclick="setToday()">TODAY</button>
                </div>
                <button class="btn-prime" onclick="handleTaskSubmit()">Add to Agenda</button>
            </div>
        </footer>
    </div>

    <div id="modal-settings" class="modal-overlay" onclick="this.style.display='none'">
        <div class="modal-sheet" onclick="event.stopPropagation()">
            <div style="width:40px; height:5px; background:var(--border); border-radius:10px; margin: 0 auto 20px;"></div>
            <h2>Settings</h2>
            <div style="margin-top:20px; background:var(--bg); padding:15px; border-radius:20px; border:1px solid var(--border);">
                <div style="font-size:10px; font-weight:900; color:var(--dim); text-transform:uppercase; margin-bottom:4px;">User Identity</div>
                <div id="user-display" style="font-weight:700;">...</div>
            </div>
            <h3 style="margin:25px 0 10px; font-size:14px; text-transform:uppercase; color:var(--dim);">Appearance</h3>
            <div style="display:flex; gap:8px; overflow-x:auto; padding-bottom:10px; scrollbar-width:none;">
                <button class="tab-pill" onclick="setTheme('theme-midnight')">Midnight</button>
                <button class="tab-pill" onclick="setTheme('theme-solar')">Solar</button>
                <button class="tab-pill" onclick="setTheme('theme-cyber')">Cyber</button>
                <button class="tab-pill" onclick="setTheme('theme-forest')">Forest</button>
                <button class="tab-pill" onclick="setTheme('theme-silver')">Silver</button>
            </div>
            <h3 style="margin:25px 0 10px; font-size:14px; text-transform:uppercase; color:var(--dim);">Agendas</h3>
            <div id="list-manager-container"></div>
            <button class="btn-prime" style="background:var(--error); color:white; margin-top:20px;" onclick="auth.signOut(); location.reload();">Terminate Session</button>
        </div>
    </div>

    <div id="modal-new-list" class="modal-overlay" onclick="this.style.display='none'">
        <div class="modal-sheet" onclick="event.stopPropagation()">
            <h2>New Workspace</h2>
            <input type="text" id="n-list-name" placeholder="Title">
            <button class="btn-prime" onclick="createNewAgenda()">Create</button>
        </div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyCEdkitaytyO0ZHL-bbU0R1p_oy8E1RhbY",
            authDomain: "plannerapp-ff221.firebaseapp.com",
            projectId: "plannerapp-ff221",
            storageBucket: "plannerapp-ff221.appspot.com",
            messagingSenderId: "282165391993",
            appId: "1:282165391993:web:cd1b9e50b03a68edfb9aa8"
        };
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        let activeTab = 'General';
        let allTasks = [];
        let agendas = JSON.parse(localStorage.getItem('agendas_v22')) || [{id:'General'}];

        async function handleAuth() {
            const name = document.getElementById('auth-name').value;
            const email = document.getElementById('auth-email').value;
            const pass = document.getElementById('auth-pass').value;
            if(!email || !pass) return alert("Credentials required");
            try { 
                const res = await auth.signInWithEmailAndPassword(email, pass);
                if(name) await res.user.updateProfile({ displayName: name });
            } catch (e) { 
                try { 
                    const res = await auth.createUserWithEmailAndPassword(email, pass);
                    if(name) await res.user.updateProfile({ displayName: name });
                } catch(err) { alert(err.message); } 
            }
        }

        window.googleSignIn = () => { auth.signInWithPopup(new firebase.auth.GoogleAuthProvider()); };

        auth.onAuthStateChanged(user => {
            if (user) {
                document.getElementById('login-screen').style.display = 'none';
                document.getElementById('app-shell').style.display = 'flex';
                document.getElementById('user-display').innerText = user.displayName || user.email;
                sync(user.uid);
            } else {
                document.getElementById('login-screen').style.display = 'flex';
                document.getElementById('app-shell').style.display = 'none';
            }
        });

        window.setTheme = (t) => { document.body.className = t; localStorage.setItem('theme_v22', t); };
        if(localStorage.getItem('theme_v22')) setTheme(localStorage.getItem('theme_v22'));
        window.setToday = () => { document.getElementById('d-input').valueAsDate = new Date(); };
        window.openModal = (id) => { if(id === 'modal-settings') renderListManager(); document.getElementById(id).style.display = 'flex'; };
        
        window.createNewAgenda = () => {
            const n = document.getElementById('n-list-name').value.trim();
            if(!n) return;
            agendas.push({id: n});
            activeTab = n; saveAgendas(); render();
            document.getElementById('modal-new-list').style.display = 'none';
        };

        window.deleteAgenda = (id) => {
            if(agendas.length <= 1) return;
            agendas = agendas.filter(a => a.id !== id);
            if(activeTab === id) activeTab = agendas[0].id;
            saveAgendas(); render(); renderListManager();
        };

        function saveAgendas() { localStorage.setItem('agendas_v22', JSON.stringify(agendas)); }

        function renderListManager() {
            document.getElementById('list-manager-container').innerHTML = agendas.map(a => `
                <div style="display:flex; justify-content:space-between; align-items:center; padding:15px; background:var(--bg); border-radius:15px; margin-bottom:8px; border:1px solid var(--border);">
                    <span style="font-weight:700;">${a.id}</span>
                    <button onclick="deleteAgenda('${a.id}')" style="background:none; border:none; color:var(--error); font-weight:900; font-size:11px;">REVERSE</button>
                </div>
            `).join('');
        }

        function sync(uid) {
            db.collection("tasks").where("uid", "==", uid).onSnapshot(snap => {
                allTasks = snap.docs.map(d => ({id: d.id, ...d.data()}));
                render();
            });
        }

        window.handleTaskSubmit = () => {
            const name = document.getElementById('t-input').value;
            const date = document.getElementById('d-input').value;
            if(!name || !date) return;
            db.collection("tasks").add({ name, date, category: activeTab, uid: auth.currentUser.uid });
            document.getElementById('t-input').value = '';
        };

        function render() {
            document.getElementById('tab-bar').innerHTML = agendas.map(a => `<div class="tab-pill ${a.id === activeTab ? 'active' : ''}" onclick="activeTab='${a.id}'; render();">${a.id}</div>`).join('');
            const main = document.getElementById('main-content');
            main.innerHTML = '';
            const filtered = allTasks.filter(t => t.category === activeTab).sort((a,b) => new Date(a.date) - new Date(b.date));
            const groups = {};
            filtered.forEach(t => {
                const d = new Date(t.date + "T00:00:00");
                const key = d.toLocaleString('default', { month: 'long', year: 'numeric' });
                if (!groups[key]) groups[key] = [];
                groups[key].push(t);
            });
            for (const key in groups) {
                const sec = document.createElement('div');
                sec.innerHTML = `<div style="font-size:10px; font-weight:900; text-transform:uppercase; color:var(--accent); margin:25px 0 10px;">${key}</div>`;
                groups[key].forEach(task => {
                    const card = document.createElement('div');
                    card.className = 'card';
                    card.innerHTML = `<div><b style="font-size:17px;">${task.name}</b><br><small style="color:var(--dim);">${task.date}</small></div><div style="color:var(--error); font-weight:bold; padding:10px; cursor:pointer;" onclick="db.collection('tasks').doc('${task.id}').delete()">✕</div>`;
                    sec.appendChild(card);
                });
                main.appendChild(sec);
            }
        }
    </script>
</body>
</html>
