<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Agenda Pro | V3.5.3</title>

    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>

    <style>
        :root {
            --bg: #000000; --card: #1c1c1e; --border: #2c2c2e; --text: #ffffff;
            --dim: #8e8e93; --accent: #ffd60a; --error: #ff375f;
            --input-bg: #1c1c1e;
            --safe-top: env(safe-area-inset-top, 20px);
            --safe-bottom: env(safe-area-inset-bottom, 20px);
        }

        /* Themes */
        body.theme-midnight { --bg: #000; --card: #1c1c1e; --accent: #ffd60a; }
        body.theme-solar { --bg: #1a1a1a; --card: #242424; --accent: #ffb300; }
        body.theme-cyber { --bg: #05010d; --card: #12042b; --accent: #ff00ff; }
        body.theme-forest { --bg: #0d140e; --card: #1a241c; --accent: #5efc82; }
        body.theme-silver { --bg: #f2f2f7; --card: #ffffff; --accent: #007aff; --text: #000; --border: #d1d1d6; --input-bg: #e5e5ea; }
        body.theme-matrix { --bg: #000; --card: #000; --accent: #00ff41; --border: #003b00; --text: #00ff41; --input-bg: #001100; }
        body.theme-ruby { --bg: #120000; --card: #1f0000; --accent: #ff3b3b; --border: #3d0000; }
        body.theme-lavender { --bg: #121021; --card: #1d1a33; --accent: #b19cd9; --border: #2d2a4a; }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; font-family: -apple-system, system-ui, sans-serif; }
        body { margin: 0; background: var(--bg); color: var(--text); overflow: hidden; height: 100vh; transition: 0.4s; }

        #global-loader { position: fixed; inset: 0; background: #000; z-index: 10000; display: flex; align-items: center; justify-content: center; flex-direction: column; }
        .spinner { width: 40px; height: 40px; border: 4px solid rgba(255,255,255,0.1); border-top-color: var(--accent); border-radius: 50%; animation: spin 0.8s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }

        .full-screen { position: fixed; inset: 0; background: var(--bg); z-index: 5000; display: none; flex-direction: column; align-items: center; justify-content: center; padding: 30px; text-align: center; }
        .auth-container { width: 100%; max-width: 400px; display: none; flex-direction: column; gap: 12px; }
        .auth-container.active { display: flex; }
        
        .btn-prime { width: 100%; padding: 18px; border-radius: 20px; border: none; font-weight: 900; text-transform: uppercase; cursor: pointer; transition: 0.2s; display: flex; align-items: center; justify-content: center; gap: 10px; }
        .btn-prime:active { transform: scale(0.98); }
        .btn-save { background: var(--accent); color: #000; }
        .btn-ghost { background: transparent; color: var(--dim); border: 1px solid var(--border); margin-top: 10px; }
        .btn-danger { background: rgba(255, 55, 95, 0.1); color: var(--error); border: 1px solid var(--error); }

        #app-shell { display: none; flex-direction: column; height: 100vh; opacity: 0; transition: 0.5s; }
        #app-shell.ready { opacity: 1; }
        #app-shell.modal-active { transform: scale(0.96); filter: blur(10px); pointer-events: none; }

        header { padding: calc(var(--safe-top) + 20px) 25px 10px; background: var(--bg); border-bottom: 1px solid var(--border); z-index: 100; }
        .header-top { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .header-top h1 { margin: 0; font-size: 34px; font-weight: 900; letter-spacing: -1.5px; }

        .nav-scroller { display: flex; gap: 12px; overflow-x: auto; padding-bottom: 15px; scrollbar-width: none; }
        .nav-scroller::-webkit-scrollbar { display: none; }
        .tab-pill { flex-shrink: 0; padding: 10px 22px; border-radius: 50px; background: var(--card); color: var(--dim); font-size: 13px; font-weight: 800; border: 1px solid var(--border); cursor: pointer; }
        .tab-pill.active { background: var(--accent); color: #000; border-color: var(--accent); }

        main { flex: 1; overflow-y: auto; padding: 25px; padding-bottom: 250px; }
        .card { background: var(--card); border: 1px solid var(--border); border-radius: 24px; padding: 20px; margin-bottom: 12px; display: flex; justify-content: space-between; align-items: center; }
        .month-label { font-size: 11px; text-transform: uppercase; letter-spacing: 2px; color: var(--accent); font-weight: 900; margin: 25px 0 15px; display: flex; align-items: center; gap: 15px; }
        .month-label::after { content: ""; height: 1px; background: var(--border); flex: 1; }

        .modal-overlay { position: fixed; inset: 0; z-index: 6000; background: rgba(0,0,0,0.85); display: none; align-items: flex-end; justify-content: center; opacity: 0; transition: 0.3s; backdrop-filter: blur(10px); }
        .modal-overlay.active { display: flex; opacity: 1; }
        .modal-sheet { background: var(--card); width: 100%; max-width: 500px; border-radius: 40px 40px 0 0; padding: 30px; padding-bottom: calc(var(--safe-bottom) + 20px); transform: translateY(100%); transition: 0.4s cubic-bezier(0.16, 1, 0.3, 1); border-top: 1px solid var(--border); max-height: 85vh; overflow-y: auto; }
        .modal-overlay.active .modal-sheet { transform: translateY(0); }

        footer { position: fixed; bottom: 0; left: 0; right: 0; padding: 20px; padding-bottom: calc(var(--safe-bottom) + 15px); background: linear-gradient(to top, var(--bg) 80%, transparent); }
        .input-box { background: var(--card); border: 1px solid var(--border); border-radius: 30px; padding: 12px; }
        input, select { background: var(--input-bg); border: 1px solid var(--border); color: var(--text); padding: 14px; border-radius: 18px; font-size: 15px; width: 100%; outline: none; }
        
        .theme-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-top: 15px; }
        .theme-dot { height: 40px; border-radius: 12px; border: 2px solid var(--border); cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 10px; font-weight: 800; text-transform: uppercase; }
        
        #admin-panel { display: none; margin-top: 30px; padding-top: 20px; border-top: 2px dashed var(--error); }
        #standard-del-wrapper { margin-top: 10px; }
    </style>
</head>
<body class="theme-midnight">

    <div id="global-loader"><div class="spinner"></div></div>

    <div id="screen-landing" class="full-screen">
        <h1 style="font-size: 64px; letter-spacing: -4px;">Agenda.</h1>
        <div class="auth-container active" id="auth-main">
            <button class="btn-prime btn-save" onclick="showAuth('auth-login')">Sign In</button>
            <button class="btn-prime btn-ghost" onclick="showAuth('auth-signup')">Create Account</button>
            <div style="margin: 15px 0; color: var(--dim); font-size: 10px; font-weight: 800;">OR</div>
            <button class="btn-prime" style="background: #fff; color: #000;" onclick="handleGoogleLogin()">Continue with Google</button>
        </div>
        <div class="auth-container" id="auth-signup">
            <h2>New Account</h2>
            <input type="text" id="su-first" placeholder="Name">
            <input type="email" id="su-email" placeholder="Email">
            <input type="password" id="su-pass" placeholder="Password">
            <button class="btn-prime btn-save" id="signup-btn" onclick="handleSignUpProcess()">Send Code</button>
            <button class="btn-prime btn-ghost" onclick="showAuth('auth-main')">Back</button>
        </div>
        <div class="auth-container" id="auth-login">
            <h2>Welcome Back</h2>
            <input type="email" id="li-email" placeholder="Email">
            <input type="password" id="li-pass" placeholder="Password">
            <div id="li-error" style="color:var(--error); font-size:12px;"></div>
            <button class="btn-prime btn-save" onclick="handleEmailLogin()">Sign In</button>
            <button class="btn-prime btn-ghost" onclick="showAuth('auth-main')">Back</button>
        </div>
        <div class="auth-container" id="auth-verify">
            <h2>Check Email</h2>
            <p id="v-info" style="font-size:12px; color:var(--dim);"></p>
            <input type="text" id="v-code" placeholder="000000" maxlength="6" style="text-align:center; font-size:32px; letter-spacing:8px;">
            <button class="btn-prime btn-save" onclick="validateCode()">Confirm</button>
            <button class="btn-prime btn-ghost" onclick="handleSignUpProcess()">Resend</button>
        </div>
    </div>

    <div id="screen-intro" class="full-screen">
        <div class="auth-container active">
            <h2>First Agenda</h2>
            <input type="text" id="intro-name" placeholder="e.g. Daily Tasks">
            <button class="btn-prime btn-save" onclick="completeOnboarding()" style="margin-top:20px;">Get Started</button>
        </div>
    </div>

    <div id="app-shell">
        <header>
            <div class="header-top">
                <h1>Agenda</h1>
                <div style="display:flex; gap:15px;">
                    <div onclick="openModal('modal-new-list')" style="color:var(--accent); font-weight:900; font-size:28px; cursor:pointer;">+</div>
                    <div onclick="openModal('modal-settings')" style="color:var(--accent); font-weight:900; font-size:24px; cursor:pointer;">⚙</div>
                </div>
            </div>
            <div class="nav-scroller" id="tab-bar"></div>
        </header>
        <main id="main-content"></main>
        <footer>
            <div class="input-box">
                <div style="display:flex; gap:10px; margin-bottom:10px;">
                    <input type="text" id="t-input" placeholder="What's the task?">
                    <input type="date" id="d-input" style="width:140px;">
                </div>
                <button class="btn-prime btn-save" id="s-btn" onclick="handleTaskSubmit()">Save Item</button>
                <button id="cancel-edit" style="display:none; width:100%; border:none; background:none; color:var(--dim); font-size:12px; margin-top:10px;" onclick="resetForm()">DISCARD EDIT</button>
            </div>
        </footer>
    </div>

    <div id="modal-settings" class="modal-overlay" onclick="closeAllModals()"><div class="modal-sheet" onclick="event.stopPropagation()">
        <h2>Account</h2>
        <div style="padding:20px; background:var(--bg); border-radius:24px; margin-bottom:20px; display:flex; align-items:center; gap:15px; border:1px solid var(--border);">
            <div id="u-avatar" style="width:50px; height:50px; border-radius:50%; background:var(--accent); color:#000; display:flex; align-items:center; justify-content:center; font-weight:900; font-size:20px;">?</div>
            <div>
                <b id="u-name" style="font-size:18px;">---</b><br>
                <span id="u-email" style="font-size:12px; color:var(--dim);">---</span>
                <div id="admin-badge" style="display:none; font-size:10px; color:var(--accent); font-weight:900; margin-top:4px;">MASTER ADMIN ENABLED</div>
            </div>
        </div>

        <div id="admin-panel">
            <h3 style="color:var(--error); margin-bottom:5px;">System Override</h3>
            <p style="font-size:11px; color:var(--dim); margin-bottom:15px;">Wipe any user from the Firestore database.</p>
            <input type="email" id="admin-target-email" placeholder="Target User Email" style="border-color:var(--error);">
            <button class="btn-prime btn-danger" onclick="masterWipeUser()" style="margin-top:10px; background:var(--error); color:#fff;">GLOBAL WIPE USER</button>
        </div>
        
        <p style="font-size:10px; font-weight:900; color:var(--accent); text-transform:uppercase; margin-top:25px;">Personalization</p>
        <div class="theme-grid">
            <div class="theme-dot" style="background:#000; color:#ffd60a;" onclick="updateTheme('theme-midnight')">Dark</div>
            <div class="theme-dot" style="background:#05010d; color:#ff00ff;" onclick="updateTheme('theme-cyber')">Cyber</div>
            <div class="theme-dot" style="background:#000; color:#00ff41;" onclick="updateTheme('theme-matrix')">Matrix</div>
            <div class="theme-dot" style="background:#121021; color:#b19cd9;" onclick="updateTheme('theme-lavender')">Soft</div>
            <div class="theme-dot" style="background:#1a1a1a; color:#ffb300;" onclick="updateTheme('theme-solar')">Solar</div>
            <div class="theme-dot" style="background:#0d140e; color:#5efc82;" onclick="updateTheme('theme-forest')">Wood</div>
            <div class="theme-dot" style="background:#f2f2f7; color:#007aff;" onclick="updateTheme('theme-silver')">Light</div>
            <div class="theme-dot" style="background:#120000; color:#ff3b3b;" onclick="updateTheme('theme-ruby')">Ruby</div>
        </div>

        <p style="font-size:10px; font-weight:900; color:var(--accent); text-transform:uppercase; margin-top:25px;">My Agendas</p>
        <div id="agendas-list"></div>
        
        <button class="btn-prime btn-ghost" onclick="handleSwitchAccount()" style="margin-top:20px;">Switch User</button>
        <button class="btn-prime" onclick="auth.signOut()" style="margin-top:10px;">Sign Out</button>
        
        <div id="standard-del-wrapper">
            <p id="del-notice" style="font-size:11px; color:var(--dim); text-align:center; margin-top:15px;">To delete your account, contact support at burgerman0316@gmail.com</p>
            <button id="self-del-btn" class="btn-prime btn-danger" onclick="handleDeleteAccount()" style="margin-top:10px; display:none;">Delete My Account</button>
        </div>
    </div></div>

    <div id="modal-new-list" class="modal-overlay" onclick="closeAllModals()"><div class="modal-sheet" onclick="event.stopPropagation()">
        <h2>New Agenda</h2>
        <input type="text" id="n-name" placeholder="Name">
        <select id="n-type" style="margin:15px 0;"><option value="Standard">Standard</option><option value="Countdown">Countdown</option><option value="Finance">Finance</option></select>
        <button class="btn-prime btn-save" onclick="createNewAgenda()">Create</button>
    </div></div>

    <script>
        const EMAILJS_SERVICE_ID="service_ow9m3kg", EMAILJS_TEMPLATE_ID="template_7xhxmoi", EMAILJS_PUBLIC_KEY="RsAYqiwym2mViUR8u";
        const firebaseConfig = { apiKey: "AIzaSyCEdkitaytyO0ZHL-bbU0R1p_oy8E1RhbY", authDomain: "plannerapp-ff221.firebaseapp.com", projectId: "plannerapp-ff221", storageBucket: "plannerapp-ff221.appspot.com", messagingSenderId: "282165391993", appId: "1:282165391993:web:cd1b9e50b03a68edfb9aa8" };

        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth(), db = firebase.firestore();
        emailjs.init(EMAILJS_PUBLIC_KEY);

        const SUPER_ADMIN = "burgerman0316@gmail.com";
        let activeTab = '', allTasks = [], agendas = [], editId = null, vCode = "", signupTemp = null;

        function setVisibility(s) {
            document.getElementById('global-loader').style.display = (s === 'loading' ? 'flex' : 'none');
            document.getElementById('screen-landing').style.display = (s === 'landing' ? 'flex' : 'none');
            document.getElementById('screen-intro').style.display = (s === 'intro' ? 'flex' : 'none');
            document.getElementById('app-shell').style.display = (s === 'app' ? 'flex' : 'none');
            if(s === 'app') setTimeout(() => document.getElementById('app-shell').classList.add('ready'), 50);
        }

        function showAuth(id) {
            document.querySelectorAll('.auth-container').forEach(c => c.classList.remove('active'));
            document.getElementById(id).classList.add('active');
        }

        auth.onAuthStateChanged(user => {
            if (user) {
                db.collection('users').doc(user.uid).get().then(doc => {
                    if(!doc.exists) setVisibility('intro');
                    else initApp(user, doc.data());
                }).catch(() => setVisibility('landing'));
            } else setVisibility('landing');
        });

        function initApp(user, data) {
            document.getElementById('u-name').innerText = user.displayName || "User";
            document.getElementById('u-email').innerText = user.email;
            document.getElementById('u-avatar').innerText = (user.displayName || "U")[0].toUpperCase();
            
            if(user.email === SUPER_ADMIN) {
                document.getElementById('admin-badge').style.display = 'block';
                document.getElementById('admin-panel').style.display = 'block';
                document.getElementById('self-del-btn').style.display = 'flex';
                document.getElementById('del-notice').style.display = 'none';
            } else {
                document.getElementById('admin-badge').style.display = 'none';
                document.getElementById('admin-panel').style.display = 'none';
                document.getElementById('self-del-btn').style.display = 'none';
                document.getElementById('del-notice').style.display = 'block';
            }

            agendas = data.agendas || [];
            if(!activeTab && agendas.length > 0) activeTab = agendas[0].id;
            document.body.className = data.theme || 'theme-midnight';
            db.collection("tasks").where("uid", "==", user.uid).onSnapshot(snap => {
                allTasks = snap.docs.map(d => ({id: d.id, ...d.data()}));
                render();
            });
            setVisibility('app');
        }

        // IMPROVED MASTER ADMIN WIPER
        async function masterWipeUser() {
            if (auth.currentUser.email !== SUPER_ADMIN) return;
            const target = document.getElementById('admin-target-email').value.trim().toLowerCase();
            if(!target) return alert("Please enter the email address to wipe.");
            
            if(!confirm(`MASTER OVERRIDE: This will purge every task and list associated with ${target}. Continue?`)) return;

            setVisibility('loading');
            try {
                // Search for the user doc using the email field
                const userQuery = await db.collection('users').where('email', '==', target).get();
                
                if(userQuery.empty) {
                    throw new Error(`The email "${target}" was not found. Note: They must have logged in at least once with V3.5.2+ to be indexed by email.`);
                }

                const targetUid = userQuery.docs[0].id;
                
                // Clear all tasks for that specific UID
                const tasks = await db.collection('tasks').where('uid', '==', targetUid).get();
                const batch = db.batch();
                
                tasks.forEach(t => batch.delete(t.ref));
                
                // Delete the User Profile Document
                batch.delete(db.collection('users').doc(targetUid));
                
                await batch.commit();
                alert(`SUCCESS: ${target} has been wiped from the database.`);
                document.getElementById('admin-target-email').value = '';
            } catch(e) { 
                alert("ADMIN ERROR: " + e.message); 
            }
            setVisibility('app');
        }

        // AUTH & TASK LOGIC
        async function handleGoogleLogin() {
            setVisibility('loading');
            try { 
                const res = await auth.signInWithPopup(new firebase.auth.GoogleAuthProvider());
                // Always ensure email is indexed on login for admin search
                await db.collection('users').doc(res.user.uid).set({
                    email: res.user.email.toLowerCase(),
                    lastLogin: new Date().toISOString()
                }, { merge: true });
            }
            catch(e) { setVisibility('landing'); }
        }

        async function handleEmailLogin() {
            setVisibility('loading');
            const e = document.getElementById('li-email').value, p = document.getElementById('li-pass').value;
            auth.signInWithEmailAndPassword(e, p).then(res => {
                // Update index
                db.collection('users').doc(res.user.uid).set({ email: e.toLowerCase() }, { merge: true });
            }).catch(err => {
                setVisibility('landing');
                document.getElementById('li-error').innerText = "Login Failed: " + err.message;
            });
        }

        async function handleSignUpProcess() {
            const e = document.getElementById('su-email').value, f = document.getElementById('su-first').value, p = document.getElementById('su-pass').value;
            if(!e || !f || !p) return;
            signupTemp = { email: e, pass: p, name: f };
            vCode = Math.floor(100000 + Math.random() * 900000).toString();
            try {
                await emailjs.send(EMAILJS_SERVICE_ID, EMAILJS_TEMPLATE_ID, { to_email: e, verification_code: vCode, user_name: f });
                document.getElementById('v-info').innerText = `Sent to ${e}`;
                showAuth('auth-verify');
            } catch(err) { alert("Code delivery failed."); }
        }

        async function validateCode() {
            if(document.getElementById('v-code').value === vCode) {
                setVisibility('loading');
                try {
                    const res = await auth.createUserWithEmailAndPassword(signupTemp.email, signupTemp.pass);
                    await res.user.updateProfile({displayName: signupTemp.name});
                    await db.collection('users').doc(res.user.uid).set({
                        email: signupTemp.email.toLowerCase(), 
                        agendas:[], 
                        theme:'theme-midnight'
                    });
                } catch(e) { alert(e.message); setVisibility('landing'); }
            }
        }

        function handleSwitchAccount() { auth.signOut().then(() => location.reload()); }

        async function handleDeleteAccount() {
            const u = auth.currentUser;
            if(!confirm("Delete your account and all tasks?")) return;
            setVisibility('loading');
            try {
                const tasks = await db.collection('tasks').where('uid', '==', u.uid).get();
                const batch = db.batch();
                tasks.forEach(t => batch.delete(t.ref));
                await batch.commit();
                await db.collection('users').doc(u.uid).delete();
                await u.delete();
                location.reload();
            } catch(e) { alert("Security timeout. Sign in again to delete."); setVisibility('app'); }
        }

        async function completeOnboarding() {
            const n = document.getElementById('intro-name').value || "Agenda";
            const data = { 
                email: auth.currentUser.email.toLowerCase(), 
                theme: 'theme-midnight', 
                agendas: [{id: n, type: 'Standard'}] 
            };
            await db.collection('users').doc(auth.currentUser.uid).set(data, {merge: true});
            initApp(auth.currentUser, data);
        }

        function render() {
            document.getElementById('tab-bar').innerHTML = agendas.map(a => `<div class="tab-pill ${a.id === activeTab ? 'active' : ''}" onclick="activeTab='${a.id}'; render();">${a.id}</div>`).join('');
            const type = agendas.find(a => a.id === activeTab)?.type;
            const filtered = allTasks.filter(t => t.category === activeTab).sort((a,b) => new Date(a.date) - new Date(b.date));
            const main = document.getElementById('main-content');
            main.innerHTML = '';
            let curMonth = "";
            filtered.forEach(t => {
                const d = new Date(t.date + "T00:00:00"), m = d.toLocaleString('default', {month:'long', year:'numeric'});
                if(m !== curMonth) { curMonth = m; main.innerHTML += `<div class="month-label">${m}</div>`; }
                main.innerHTML += `<div class="card" onclick="startEdit('${t.id}')"><div><b>${type === 'Finance' ? '$'+t.name : t.name}</b><br><small style="color:var(--dim)">${t.date}</small></div><div onclick="event.stopPropagation(); db.collection('tasks').doc('${t.id}').delete()" style="color:var(--error); cursor:pointer;">✕</div></div>`;
            });
        }

        function handleTaskSubmit() {
            const n = document.getElementById('t-input').value, d = document.getElementById('d-input').value;
            if(!n || !d) return;
            const task = { name: n, date: d, category: activeTab, uid: auth.currentUser.uid };
            if(editId) { db.collection("tasks").doc(editId).update(task); resetForm(); }
            else { db.collection("tasks").add(task); document.getElementById('t-input').value = ''; }
        }

        function openModal(id) {
            const m = document.getElementById(id); m.style.display = 'flex';
            setTimeout(() => { m.classList.add('active'); document.getElementById('app-shell').classList.add('modal-active'); }, 10);
            if(id === 'modal-settings') renderAgendas();
        }

        function closeAllModals() {
            document.querySelectorAll('.modal-overlay').forEach(m => m.classList.remove('active'));
            document.getElementById('app-shell').classList.remove('modal-active');
            setTimeout(() => document.querySelectorAll('.modal-overlay').forEach(m => m.style.display = 'none'), 400);
        }

        function renderAgendas() {
            document.getElementById('agendas-list').innerHTML = agendas.map(a => `<div style="display:flex; justify-content:space-between; padding:12px; background:var(--bg); border-radius:15px; margin-bottom:5px; border:1px solid var(--border);"><span>${a.id}</span><span onclick="deleteAgenda('${a.id}')" style="color:var(--error); cursor:pointer;">✕</span></div>`).join('');
        }

        async function createNewAgenda() {
            const n = document.getElementById('n-name').value;
            if(!n) return;
            agendas.push({id: n, type: document.getElementById('n-type').value});
            activeTab = n;
            await db.collection('users').doc(auth.currentUser.uid).update({agendas});
            closeAllModals();
        }

        function deleteAgenda(id) {
            if(agendas.length <= 1) return;
            agendas = agendas.filter(a => a.id !== id);
            activeTab = agendas[0].id;
            db.collection('users').doc(auth.currentUser.uid).update({agendas});
            renderAgendas();
        }

        function startEdit(id) {
            const t = allTasks.find(x => x.id === id);
            document.getElementById('t-input').value = t.name;
            document.getElementById('d-input').value = t.date;
            editId = id; document.getElementById('s-btn').innerText = "Update Entry";
            document.getElementById('cancel-edit').style.display = 'block';
        }

        function resetForm() { editId = null; document.getElementById('t-input').value = ''; document.getElementById('s-btn').innerText = "Save Item"; document.getElementById('cancel-edit').style.display = 'none'; }
        async function updateTheme(t) { document.body.className = t; await db.collection('users').doc(auth.currentUser.uid).update({theme: t}); }
    </script>
</body>
</html>
