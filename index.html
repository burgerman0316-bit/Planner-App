<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Agenda Pro | Full Production Version</title>

    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>

    <style>
        :root {
            --bg: #000; --card: #121212; --border: #282828; --text: #ffffff;
            --dim: #888; --accent: #ffd60a; --error: #ff453a; --success: #32d74b;
            --safe-top: env(safe-area-inset-top, 20px);
            --safe-bottom: env(safe-area-inset-bottom, 20px);
        }

        * { box-sizing: border-box; font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", "Segoe UI", Roboto, Helvetica, Arial, sans-serif; -webkit-tap-highlight-color: transparent; }
        
        body { 
            margin: 0; background: var(--bg); color: var(--text); 
            height: 100vh; overflow: hidden; display: flex; flex-direction: column;
            -webkit-user-select: none; user-select: none;
        }

        /* Loading Overlay */
        #loader {
            position: fixed; inset: 0; background: #000; z-index: 20000;
            display: flex; align-items: center; justify-content: center;
            transition: opacity 0.5s ease;
        }

        /* Auth Gate Styling */
        #auth-gate { 
            position: fixed; inset: 0; background: #000; z-index: 10000; 
            display: none; flex-direction: column; align-items: center; 
            justify-content: center; padding: 40px; 
        }
        
        .auth-container { width: 100%; max-width: 360px; text-align: center; }
        .logo-text { font-size: 64px; font-weight: 900; letter-spacing: -4px; margin: 0; color: #fff; }
        .tagline { color: var(--dim); font-size: 14px; margin-bottom: 40px; text-transform: uppercase; letter-spacing: 2px; }

        .btn-stack { width: 100%; display: flex; flex-direction: column; gap: 14px; }
        .btn-auth { 
            width: 100%; padding: 20px; border-radius: 18px; border: none; 
            font-weight: 700; cursor: pointer; font-size: 15px; 
            display: flex; align-items: center; justify-content: center; gap: 12px;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .btn-google { background: #fff; color: #000; }
        .btn-github { background: #24292e; color: #fff; }
        .btn-discord { background: #5865F2; color: #fff; }
        .btn-phone { background: var(--success); color: #fff; }
        .btn-email { background: transparent; color: #fff; border: 1px solid var(--border); }
        
        .btn-auth:active { transform: scale(0.95); opacity: 0.9; }

        /* Main App UI */
        #app-shell { display: none; flex-direction: column; height: 100vh; }
        
        header { 
            padding: calc(var(--safe-top) + 20px) 25px 20px; 
            border-bottom: 1px solid var(--border); 
            display: flex; justify-content: space-between; align-items: flex-end;
            background: rgba(0,0,0,0.8); backdrop-filter: blur(20px); z-index: 100;
        }
        
        .user-info h2 { margin: 0; font-size: 32px; font-weight: 800; letter-spacing: -1.5px; }
        .user-info span { font-size: 12px; color: var(--dim); text-transform: uppercase; font-weight: 600; }

        main { 
            flex: 1; overflow-y: auto; padding: 20px; 
            padding-bottom: 280px; scroll-behavior: smooth;
        }

        .task-card { 
            background: var(--card); border: 1px solid var(--border); 
            border-radius: 24px; padding: 22px; margin-bottom: 15px; 
            display: flex; justify-content: space-between; align-items: center;
            animation: cardIn 0.5s cubic-bezier(0.2, 1, 0.3, 1);
        }

        @keyframes cardIn {
            from { opacity: 0; transform: translateY(20px) scale(0.98); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }

        .task-content h3 { margin: 0; font-size: 18px; font-weight: 700; color: #fff; }
        .task-content p { margin: 4px 0 0; font-size: 13px; color: var(--dim); font-weight: 500; }

        .btn-delete { 
            background: #1a1a1a; color: var(--error); border: none; 
            width: 44px; height: 44px; border-radius: 50%; 
            display: flex; align-items: center; justify-content: center;
            font-size: 20px; cursor: pointer; transition: 0.2s;
        }
        .btn-delete:active { background: var(--error); color: #fff; }

        /* Input Area */
        footer { 
            position: fixed; bottom: 0; width: 100%; 
            padding: 20px; padding-bottom: calc(var(--safe-bottom) + 20px);
            background: linear-gradient(to top, #000 80%, transparent);
            z-index: 100;
        }

        .input-panel { 
            background: #0a0a0a; border: 1px solid var(--border); 
            border-radius: 32px; padding: 12px; 
            display: flex; flex-direction: column; gap: 8px;
            box-shadow: 0 -20px 60px rgba(0,0,0,0.7);
        }

        .input-panel input { 
            background: transparent; border: none; color: #fff; 
            padding: 12px 18px; font-size: 17px; outline: none;
            width: 100%;
        }

        .btn-submit { 
            background: var(--accent); color: #000; border: none; 
            padding: 18px; border-radius: 24px; font-weight: 900; 
            font-size: 14px; letter-spacing: 1px; cursor: pointer;
            text-transform: uppercase;
        }

        #recaptcha-container { display: none; }
    </style>
</head>
<body>

    <div id="loader"><div style="color:white; font-weight:800;">SYNCING...</div></div>

    <div id="auth-gate">
        <div class="auth-container">
            <h1 class="logo-text">Agenda.</h1>
            <p class="tagline">Next-Gen Productivity</p>
            
            <div class="btn-stack">
                <button class="btn-auth btn-google" onclick="initAuth('google')">Continue with Google</button>
                <button class="btn-auth btn-github" onclick="initAuth('github')">Continue with GitHub</button>
                <button class="btn-auth btn-discord" onclick="initAuth('discord')">Continue with Discord</button>
                <button class="btn-auth btn-phone" onclick="phoneFlow()">Continue with Phone</button>
                <button class="btn-auth btn-email" onclick="emailLinkFlow()">Magic Link Sign-in</button>
            </div>
        </div>
        <div id="recaptcha-container"></div>
    </div>

    <div id="app-shell">
        <header>
            <div class="user-info">
                <span id="user-status">Personal Cloud</span>
                <h2 id="display-name">My Day</h2>
            </div>
            <button onclick="signOut()" style="background:none; border:none; color:var(--error); font-weight:800; font-size:12px; letter-spacing:1px; padding:10px;">LOGOUT</button>
        </header>

        <main id="task-grid"></main>

        <footer>
            <div class="input-panel">
                <input type="text" id="task-input" placeholder="What's the mission?" autocomplete="off">
                <input type="date" id="date-input">
                <button class="btn-submit" onclick="commitTask()">Save to Agenda</button>
            </div>
        </footer>
    </div>

    <script>
        // --- FIREBASE INITIALIZATION ---
        const firebaseConfig = {
            apiKey: "AIzaSyCEdkitaytyO0ZHL-bbU0R1p_oy8E1RhbY",
            authDomain: "plannerapp-ff221.firebaseapp.com",
            projectId: "plannerapp-ff221",
            storageBucket: "plannerapp-ff221.appspot.com",
            messagingSenderId: "282165391993",
            appId: "1:282165391993:web:cd1b9e50b03a68edfb9aa8"
        };

        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // --- AUTH LOGIC ---

        // Handle Magic Link Completion
        if (auth.isSignInWithEmailLink(window.location.href)) {
            let email = window.localStorage.getItem('emailForSignIn') || window.prompt('Confirm your email to sign in:');
            auth.signInWithEmailLink(email, window.location.href)
                .then(() => window.localStorage.removeItem('emailForSignIn'))
                .catch(err => alert("Link Error: " + err.message));
        }

        async function initAuth(type) {
            let provider;
            switch(type) {
                case 'google': provider = new firebase.auth.GoogleAuthProvider(); break;
                case 'github': provider = new firebase.auth.GithubAuthProvider(); break;
                case 'discord': provider = new firebase.auth.OAuthProvider('yahoo.com'); break;
            }
            try {
                await auth.signInWithPopup(provider);
            } catch (e) {
                console.error(e);
                alert("Authentication Failed: " + e.message);
            }
        }

        async function phoneFlow() {
            const phoneNumber = prompt("Enter phone (with +country code, e.g. +15550123):");
            if (!phoneNumber) return;

            try {
                const appVerifier = new firebase.auth.RecaptchaVerifier('recaptcha-container', { 'size': 'invisible' });
                const confirmation = await auth.signInWithPhoneNumber(phoneNumber, appVerifier);
                const code = prompt("Enter 6-digit SMS code:");
                if(code) await confirmation.confirm(code);
            } catch (e) {
                alert("Phone Error: " + e.message);
            }
        }

        async function emailLinkFlow() {
            const email = prompt("Enter your email address:");
            if (!email) return;

            const config = {
                url: window.location.href,
                handleCodeInApp: true
            };

            try {
                await auth.sendSignInLinkToEmail(email, config);
                window.localStorage.setItem('emailForSignIn', email);
                alert("Magic Link sent! Please check your inbox.");
            } catch (e) {
                alert("Email Error: " + e.message);
            }
        }

        function signOut() {
            if(confirm("Sign out of Agenda Pro?")) auth.signOut();
        }

        // --- DATA LOGIC ---

        auth.onAuthStateChanged(user => {
            const loader = document.getElementById('loader');
            const gate = document.getElementById('auth-gate');
            const shell = document.getElementById('app-shell');

            if (user) {
                gate.style.display = 'none';
                shell.style.display = 'flex';
                document.getElementById('display-name').innerText = user.displayName || user.phoneNumber || user.email.split('@')[0];
                document.getElementById('user-status').innerText = user.emailVerified || user.phoneNumber ? "Verified Account" : "Cloud Sync On";
                subscribeToTasks(user.uid);
            } else {
                gate.style.display = 'flex';
                shell.style.display = 'none';
            }
            loader.style.opacity = '0';
            setTimeout(() => loader.style.display = 'none', 500);
        });

        function commitTask() {
            const name = document.getElementById('task-input').value;
            const date = document.getElementById('date-input').value;
            
            if (!name || !date) {
                alert("Please fill in both fields.");
                return;
            }

            if (navigator.vibrate) navigator.vibrate(15);

            db.collection("tasks").add({
                name: name,
                date: date,
                uid: auth.currentUser.uid,
                timestamp: firebase.firestore.FieldValue.serverTimestamp()
            }).then(() => {
                document.getElementById('task-input').value = '';
            }).catch(e => alert("Sync Failed: " + e.message));
        }

        let taskUnsubscribe = null;
        function subscribeToTasks(uid) {
            if (taskUnsubscribe) taskUnsubscribe();

            taskUnsubscribe = db.collection("tasks")
                .where("uid", "==", uid)
                .orderBy("timestamp", "desc")
                .onSnapshot(snapshot => {
                    const grid = document.getElementById('task-grid');
                    grid.innerHTML = "";
                    
                    if (snapshot.empty) {
                        grid.innerHTML = `<div style="text-align:center; padding-top:100px; color:var(--dim);">No tasks yet.<br>Start by adding one below.</div>`;
                        return;
                    }

                    snapshot.forEach(doc => {
                        const data = doc.data();
                        const item = document.createElement('div');
                        item.className = 'task-card';
                        item.innerHTML = `
                            <div class="task-content">
                                <h3>${data.name}</h3>
                                <p>ðŸ“… ${data.date}</p>
                            </div>
                            <button class="btn-delete" onclick="deleteTask('${doc.id}')">âœ•</button>
                        `;
                        grid.appendChild(item);
                    });
                }, err => {
                    console.error("Firestore Error:", err);
                    if(err.code === 'permission-denied') {
                        alert("Security Alert: You need to set up Firestore Rules in the console.");
                    }
                });
        }

        function deleteTask(id) {
            if (navigator.vibrate) navigator.vibrate([10, 30]);
            db.collection("tasks").doc(id).delete();
        }
    </script>
</body>
</html>
