<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Agenda Pro | Full System</title>

    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>

    <style>
        :root {
            /* Default Dark (Midnight) */
            --bg: #000000;
            --card: #1c1c1e;
            --border: #2c2c2e;
            --text: #ffffff;
            --dim: #8e8e93;
            --accent: #ffd60a;
            --error: #ff375f;
            --safe-top: env(safe-area-inset-top, 20px);
            --safe-bottom: env(safe-area-inset-bottom, 20px);
        }

        /* --- THEME LIBRARY --- */
        body.theme-light {
            --bg: #f2f2f7; --card: #ffffff; --border: #d1d1d6;
            --text: #000000; --dim: #636366; --accent: #007aff;
        }
        body.theme-paper {
            --bg: #f9f5eb; --card: #ffffff; --border: #e4dccf;
            --text: #1c2b2d; --dim: #7d9d9c; --accent: #eb6440;
        }
        body.theme-nord {
            --bg: #2e3440; --card: #3b4252; --border: #4c566a;
            --text: #eceff4; --dim: #a3be8c; --accent: #88c0d0;
        }
        body.theme-emerald {
            --bg: #040d06; --card: #0d1a10; --border: #152a1a;
            --text: #e8f5e9; --dim: #81c784; --accent: #34c759;
        }
        body.theme-sunset {
            --bg: #0d0404; --card: #1a0d0d; --border: #2a1515;
            --text: #fff5f5; --dim: #e57373; --accent: #ff375f;
        }

        * { 
            box-sizing: border-box; 
            -webkit-tap-highlight-color: transparent; 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        }

        body {
            margin: 0;
            background: var(--bg);
            color: var(--text);
            overflow: hidden;
            height: 100vh;
            display: flex;
            flex-direction: column;
            transition: background 0.4s ease, color 0.4s ease;
        }

        #app-shell {
            display: none;
            flex-direction: column;
            height: 100vh;
            transition: transform 0.6s cubic-bezier(0.16, 1, 0.3, 1), filter 0.6s;
        }

        #app-shell.modal-active {
            transform: scale(0.92);
            filter: blur(15px);
            pointer-events: none;
            border-radius: 40px;
        }

        /* HEADER: Increased padding to ensure no cutoff */
        header {
            padding-top: calc(var(--safe-top) + 40px); 
            padding-bottom: 20px;
            background: var(--bg);
            border-bottom: 1px solid var(--border);
            z-index: 100;
        }

        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding: 0 25px;
        }

        .header-top h1 { margin: 0; font-size: 34px; font-weight: 800; letter-spacing: -1.2px; }

        .nav-scroller {
            display: flex;
            gap: 12px;
            overflow-x: auto;
            padding: 0 25px 5px;
            scrollbar-width: none;
            -webkit-overflow-scrolling: touch;
        }
        .nav-scroller::-webkit-scrollbar { display: none; }

        .tab-pill {
            flex-shrink: 0;
            padding: 12px 24px;
            border-radius: 50px;
            background: var(--card);
            color: var(--dim);
            font-size: 14px;
            font-weight: 700;
            border: 1px solid var(--border);
            transition: all 0.2s ease;
        }
        .tab-pill.active {
            background: var(--accent);
            color: #fff;
            border-color: var(--accent);
        }
        body:not(.theme-light):not(.theme-paper) .tab-pill.active { color: #000; }

        main { flex: 1; overflow-y: auto; padding: 25px; padding-bottom: 320px; }
        
        .month-section { margin-bottom: 40px; }
        .month-label {
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 2px;
            color: var(--accent);
            font-weight: 900;
            margin-bottom: 20px;
            display: flex;
            align-items: center; gap: 15px;
        }
        .month-label::after { content: ""; height: 1px; background: var(--border); flex: 1; }

        .card {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 24px;
            padding: 22px;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.03);
        }

        .card-body b { display: block; font-size: 18px; margin-bottom: 6px; }
        .card-body span { font-size: 14px; color: var(--dim); }

        /* MODALS */
        .modal-overlay {
            position: fixed;
            inset: 0;
            z-index: 1000;
            background: rgba(0,0,0,0.6);
            display: none;
            align-items: flex-end;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.4s ease;
        }
        .modal-overlay.active { display: flex; opacity: 1; }

        .modal-sheet {
            background: var(--card);
            color: var(--text);
            width: 100%;
            max-width: 500px;
            border-radius: 40px 40px 0 0;
            padding: 35px;
            padding-bottom: calc(var(--safe-bottom) + 30px);
            transform: translateY(100%);
            transition: transform 0.5s cubic-bezier(0.16, 1, 0.3, 1);
            border-top: 1px solid var(--border);
        }
        .modal-overlay.active .modal-sheet { transform: translateY(0); }

        .theme-btn {
            height: 50px; border-radius: 15px; border: 2px solid var(--border);
            cursor: pointer; font-weight: 700; font-size: 13px;
        }

        /* SETTINGS UI */
        .settings-item {
            background: var(--bg);
            padding: 18px 22px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--border);
            font-size: 16px;
        }
        .settings-item:first-child { border-radius: 20px 20px 0 0; }
        .settings-item:last-child { border-radius: 0 0 20px 20px; border-bottom: none; }

        .build-footer {
            text-align: center; margin-top: 30px;
            color: var(--dim); font-size: 11px; font-family: monospace;
            letter-spacing: 1.5px; opacity: 0.6;
        }

        /* FOOTER */
        footer {
            position: fixed; bottom: 0; left: 0; right: 0;
            padding: 25px; padding-bottom: calc(var(--safe-bottom) + 20px);
            background: linear-gradient(to top, var(--bg) 80%, transparent);
            z-index: 50;
        }

        .input-box {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 35px;
            padding: 15px;
            box-shadow: 0 15px 50px rgba(0,0,0,0.1);
        }

        .input-row { display: flex; gap: 12px; margin-bottom: 12px; }
        input, select { 
            background: var(--bg); border: 1px solid var(--border); 
            color: var(--text); padding: 16px; border-radius: 20px; 
            font-size: 16px; width: 100%; 
        }

        .btn-prime { width: 100%; padding: 20px; border-radius: 22px; border: none; font-weight: 900; text-transform: uppercase; cursor: pointer; }
        .btn-add { background: var(--text); color: var(--bg); }
        .btn-save { background: var(--accent); color: #fff; }

        #login-screen { position: fixed; inset: 0; background: #000; display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 5000; }
    </style>
</head>
<body class="theme-midnight">

    <div id="login-screen">
        <h1 style="font-size:48px; margin-bottom:15px; color:white;">Agenda.</h1>
        <button class="btn-prime" style="width:auto; padding: 20px 60px; background:white; color:black;" onclick="handleLogin()">Sign In with Google</button>
    </div>

    <div id="modal-settings" class="modal-overlay" onclick="closeAllModals()">
        <div class="modal-sheet" onclick="event.stopPropagation()">
            <div style="display:flex; justify-content:space-between; margin-bottom:30px;">
                <h2 style="margin:0; font-size:26px;">Settings</h2>
                <span style="font-weight:800; color:var(--accent); cursor:pointer;" onclick="closeAllModals()">Done</span>
            </div>

            <div style="margin-bottom:30px;">
                <p style="font-size:11px; color:var(--dim); text-transform:uppercase; font-weight:800; margin-bottom:15px;">Full Themes</p>
                <div style="display:grid; grid-template-columns: 1fr 1fr 1fr; gap:10px;">
                    <button class="theme-btn" style="background:#000; color:#fff;" onclick="setTheme('theme-midnight')">Dark</button>
                    <button class="theme-btn" style="background:#f2f2f7; color:#000;" onclick="setTheme('theme-light')">Light</button>
                    <button class="theme-btn" style="background:#f9f5eb; color:#1c2b2d;" onclick="setTheme('theme-paper')">Paper</button>
                    <button class="theme-btn" style="background:#2e3440; color:#eceff4;" onclick="setTheme('theme-nord')">Nord</button>
                    <button class="theme-btn" style="background:#040d06; color:#e8f5e9;" onclick="setTheme('theme-emerald')">Green</button>
                    <button class="theme-btn" style="background:#0d0404; color:#fff5f5;" onclick="setTheme('theme-sunset')">Red</button>
                </div>
            </div>

            <div style="margin-bottom:30px;">
                <p style="font-size:11px; color:var(--dim); text-transform:uppercase; font-weight:800; margin-bottom:15px;">Manage Lists</p>
                <div id="settings-agendas-list" style="border: 1px solid var(--border); border-radius:20px; overflow:hidden;"></div>
            </div>

            <div class="settings-item" onclick="auth.signOut()" style="border-radius:20px; color:var(--error); font-weight:700; background: var(--bg); cursor:pointer;">
                <span>Sign Out</span>
                <span>→</span>
            </div>

            <div class="build-footer">
                VERSION 2.3.0 <br>
                BUILD 2026.02.15_RELEASE
            </div>
        </div>
    </div>

    <div id="modal-new-list" class="modal-overlay" onclick="closeAllModals()">
        <div class="modal-sheet" onclick="event.stopPropagation()">
            <h2 style="margin-bottom:25px;">New Agenda</h2>
            <input type="text" id="n-list-name" placeholder="Name (e.g. Games, Work)" style="margin-bottom:15px;">
            <select id="n-list-type" style="margin-bottom:25px;">
                <option value="Standard">Standard List</option>
                <option value="Countdown">Countdown Style</option>
            </select>
            <button class="btn-prime btn-save" onclick="createNewAgenda()">Create Agenda</button>
        </div>
    </div>

    <div id="app-shell">
        <header>
            <div class="header-top">
                <h1>Agenda</h1>
                <div style="display:flex; gap:20px; align-items:center;">
                    <span style="font-size:36px; font-weight:200; cursor:pointer;" onclick="openModal('modal-new-list')">+</span>
                    <span style="font-size:22px; cursor:pointer;" onclick="openModal('modal-settings')">⚙</span>
                </div>
            </div>
            <div class="nav-scroller" id="tab-bar"></div>
        </header>

        <main id="main-content"></main>

        <footer>
            <div class="input-box">
                <div class="input-row">
                    <input type="text" id="t-input" placeholder="What's the plan?">
                    <input type="date" id="d-input" style="width:150px;">
                </div>
                <button class="btn-prime btn-add" id="s-btn" onclick="handleTaskSubmit()">Add to Agenda</button>
            </div>
        </footer>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyCEdkitaytyO0ZHL-bbU0R1p_oy8E1RhbY",
            authDomain: "plannerapp-ff221.firebaseapp.com",
            projectId: "plannerapp-ff221",
            storageBucket: "plannerapp-ff221.appspot.com",
            messagingSenderId: "282165391993",
            appId: "1:282165391993:web:cd1b9e50b03a68edfb9aa8"
        };
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        let activeTab = 'General';
        let allTasks = [];
        let agendas = JSON.parse(localStorage.getItem('agendas_v4')) || [{id:'General', type:'Standard'}, {id:'Releases', type:'Countdown'}];
        let editId = null;

        function handleLogin() { auth.signInWithPopup(new firebase.auth.GoogleAuthProvider()); }

        auth.onAuthStateChanged(user => {
            if (user) {
                document.getElementById('login-screen').style.display = 'none';
                document.getElementById('app-shell').style.display = 'flex';
                sync(user.uid);
            } else {
                document.getElementById('login-screen').style.display = 'flex';
                document.getElementById('app-shell').style.display = 'none';
            }
        });

        function sync(uid) {
            db.collection("tasks").where("uid", "==", uid).onSnapshot(snap => {
                allTasks = snap.docs.map(d => ({id: d.id, ...d.data()}));
                render();
            });
        }

        function openModal(id) {
            document.getElementById(id).style.display = 'flex';
            setTimeout(() => {
                document.getElementById(id).classList.add('active');
                document.getElementById('app-shell').classList.add('modal-active');
            }, 10);
        }

        function closeAllModals() {
            document.querySelectorAll('.modal-overlay').forEach(m => m.classList.remove('active'));
            document.getElementById('app-shell').classList.remove('modal-active');
            setTimeout(() => document.querySelectorAll('.modal-overlay').forEach(m => m.style.display = 'none'), 400);
        }

        function setTheme(t) { document.body.className = t; localStorage.setItem('theme_v4', t); }
        if(localStorage.getItem('theme_v4')) setTheme(localStorage.getItem('theme_v4'));

        function createNewAgenda() {
            const n = document.getElementById('n-list-name').value.trim();
            const t = document.getElementById('n-list-type').value;
            if(!n) return;
            agendas.push({id: n, type: t});
            activeTab = n;
            localStorage.setItem('agendas_v4', JSON.stringify(agendas));
            document.getElementById('n-list-name').value = '';
            closeAllModals();
            render();
        }

        function handleTaskSubmit() {
            const name = document.getElementById('t-input').value;
            const date = document.getElementById('d-input').value;
            if(!name || !date) return;
            const data = { name, date, category: activeTab, uid: auth.currentUser.uid };
            if (editId) {
                db.collection("tasks").doc(editId).update(data);
                editId = null;
                document.getElementById('s-btn').innerText = "Add to Agenda";
            } else {
                db.collection("tasks").add(data);
            }
            document.getElementById('t-input').value = '';
            document.getElementById('d-input').value = '';
        }

        window.startEdit = (id) => {
            const t = allTasks.find(x => x.id === id);
            document.getElementById('t-input').value = t.name;
            document.getElementById('d-input').value = t.date;
            editId = id;
            document.getElementById('s-btn').innerText = "Update Event";
        };

        function render() {
            document.getElementById('tab-bar').innerHTML = agendas.map(a => `<div class="tab-pill ${a.id === activeTab ? 'active' : ''}" onclick="activeTab='${a.id}'; render();">${a.id}</div>`).join('');
            document.getElementById('settings-agendas-list').innerHTML = agendas.map(a => `<div class="settings-item"><span>${a.id}</span><span style="color:var(--error); font-weight:700; cursor:pointer;" onclick="agendas=agendas.filter(x=>x.id!=='${a.id}'); localStorage.setItem('agendas_v4',JSON.stringify(agendas)); render();">Delete</span></div>`).join('');

            const main = document.getElementById('main-content');
            main.innerHTML = '';
            const current = agendas.find(a => a.id === activeTab);
            const filtered = allTasks.filter(t => t.category === activeTab).sort((a,b) => new Date(a.date) - new Date(b.date));

            const groups = {};
            const months = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
            filtered.forEach(t => {
                const d = new Date(t.date + "T00:00:00");
                const key = `${months[d.getMonth()]} ${d.getFullYear()}`;
                if (!groups[key]) groups[key] = [];
                groups[key].push(t);
            });

            for (const key in groups) {
                const sec = document.createElement('div');
                sec.className = 'month-section';
                sec.innerHTML = `<div class="month-label">${key}</div>`;
                groups[key].forEach(task => {
                    const diff = Math.ceil((new Date(task.date + "T00:00:00") - new Date()) / 86400000);
                    const badge = current.type === 'Countdown' ? `<div style="font-size:12px; font-weight:900; color:var(--accent);">${diff < 0 ? 'PASSED' : diff + ' DAYS'}</div>` : '';
                    const card = document.createElement('div');
                    card.className = 'card';
                    card.innerHTML = `<div class="card-body" onclick="startEdit('${task.id}')"><b>${task.name}</b><span>${task.date}</span></div><div style="display:flex; align-items:center; gap:15px;">${badge}<span style="color:var(--error); font-weight:900; cursor:pointer;" onclick="db.collection('tasks').doc('${task.id}').delete()">✕</span></div>`;
                    sec.appendChild(card);
                });
                main.appendChild(sec);
            }
        }
    </script>
</body>
</html>
