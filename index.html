<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Agenda Pro | V3.2</title>

    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>

    <style>
        :root {
            --bg: #000000; --card: #1c1c1e; --border: #2c2c2e; --text: #ffffff;
            --dim: #8e8e93; --accent: #ffd60a; --error: #ff375f;
            --input-bg: #1c1c1e; --icon-color: #ffffff;
            --safe-top: env(safe-area-inset-top, 20px);
            --safe-bottom: env(safe-area-inset-bottom, 20px);
        }

        /* --- THEMES --- */
        body.theme-midnight { --bg: #000; --card: #1c1c1e; --accent: #ffd60a; }
        body.theme-solar { --bg: #1a1a1a; --card: #242424; --accent: #ffb300; --icon-color: #ffb300; }
        body.theme-cyber { --bg: #05010d; --card: #12042b; --accent: #ff00ff; --icon-color: #ff00ff; }
        body.theme-silver { --bg: #f2f2f7; --card: #ffffff; --accent: #007aff; --text: #000; --border: #d1d1d6; --input-bg: #e5e5ea; --icon-color: #007aff; }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; font-family: -apple-system, system-ui, sans-serif; }
        body { margin: 0; background: var(--bg); color: var(--text); overflow: hidden; height: 100vh; display: flex; flex-direction: column; }

        /* Login Screen UI */
        #login-screen { position: fixed; inset: 0; background: #000; display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 5000; padding: 40px; }
        .login-container { width: 100%; max-width: 350px; text-align: center; }
        .auth-grid { display: grid; grid-template-columns: 1fr; gap: 10px; width: 100%; margin-top: 30px; }
        .btn-auth { width: 100%; padding: 14px; border-radius: 12px; border: none; font-weight: 700; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 10px; font-size: 14px; }
        .btn-google { background: #fff; color: #000; }
        .btn-apple { background: #000; color: #fff; border: 1px solid #444; }
        .btn-discord { background: #5865F2; color: #fff; }
        .btn-msft { background: #2F2F2F; color: #fff; }
        .btn-phone { background: var(--accent); color: #000; }

        /* App Layout */
        #app-shell { display: none; flex-direction: column; height: 100vh; }
        header { padding: calc(var(--safe-top) + 20px) 25px 20px; border-bottom: 1px solid var(--border); }
        .header-top { display: flex; justify-content: space-between; align-items: center; }
        .nav-scroller { display: flex; gap: 10px; overflow-x: auto; padding: 15px 25px; scrollbar-width: none; }
        .tab-pill { flex-shrink: 0; padding: 8px 18px; border-radius: 50px; background: var(--card); color: var(--dim); font-size: 13px; border: 1px solid var(--border); }
        .tab-pill.active { background: var(--accent); color: #000; border-color: var(--accent); }

        main { flex: 1; overflow-y: auto; padding: 25px; padding-bottom: 250px; }
        .card { background: var(--card); border: 1px solid var(--border); border-radius: 20px; padding: 18px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; position: relative; }
        
        .modal-overlay { position: fixed; inset: 0; z-index: 1000; background: rgba(0,0,0,0.8); display: none; align-items: flex-end; backdrop-filter: blur(10px); }
        .modal-sheet { background: var(--card); width: 100%; border-radius: 30px 30px 0 0; padding: 30px; max-height: 90vh; display: flex; flex-direction: column; }
        .modal-scroll { flex: 1; overflow-y: auto; }

        footer { position: fixed; bottom: 0; width: 100%; padding: 20px; background: var(--bg); border-top: 1px solid var(--border); }
        .build-tag { text-align: center; font-size: 10px; color: var(--dim); margin-top: 20px; letter-spacing: 1px; }
    </style>
</head>
<body class="theme-midnight">

    <div id="login-screen">
        <div class="login-container">
            <h1 style="font-size:48px; letter-spacing:-2px; margin-bottom:5px;">Agenda.</h1>
            <p style="color:var(--dim); margin-bottom:30px;">Choose a sign-in method</p>
            
            <div class="auth-grid">
                <button class="btn-auth btn-google" onclick="login('google')">Sign in with Google</button>
                <button class="btn-auth btn-apple" onclick="login('apple')">Sign in with Apple</button>
                <button class="btn-auth btn-msft" onclick="login('microsoft')">Sign in with Microsoft</button>
                <button class="btn-auth btn-discord" onclick="login('discord')">Sign in with Discord</button>
                <button class="btn-auth btn-phone" onclick="loginPhone()">Sign in with Phone</button>
            </div>
            <div id="recaptcha-container" style="margin-top:20px;"></div>
        </div>
    </div>

    <div id="app-shell">
        <header>
            <div class="header-top">
                <h1 style="margin:0; font-size:32px;">My Day</h1>
                <div style="display:flex; gap:10px;">
                    <button onclick="openModal('modal-settings')" style="background:none; border:none; color:var(--accent); font-weight:700;">SETTINGS</button>
                </div>
            </div>
        </header>
        
        <div class="nav-scroller" id="tab-bar"></div>
        <main id="main-content"></main>

        <footer>
            <div style="display:flex; gap:10px; margin-bottom:10px;">
                <input type="text" id="t-input" placeholder="Task name..." style="flex:2; padding:12px; border-radius:10px; border:1px solid var(--border); background:var(--input-bg); color:white;">
                <input type="date" id="d-input" style="flex:1; padding:12px; border-radius:10px; border:1px solid var(--border); background:var(--input-bg); color:white;">
            </div>
            <button onclick="handleTaskSubmit()" style="width:100%; padding:15px; border-radius:12px; background:var(--accent); color:black; font-weight:800; border:none;">ADD TASK</button>
        </footer>
    </div>

    <div id="modal-settings" class="modal-overlay" onclick="closeModal()">
        <div class="modal-sheet" onclick="event.stopPropagation()">
            <div style="display:flex; justify-content:space-between; margin-bottom:20px;">
                <h2 style="margin:0;">Settings</h2>
                <button onclick="closeModal()">CLOSE</button>
            </div>
            <div class="modal-scroll">
                <div id="account-info" style="background:var(--bg); padding:15px; border-radius:15px; display:flex; align-items:center; gap:15px; margin-bottom:20px;">
                    <img id="user-img" src="" style="width:50px; height:50px; border-radius:50%; background:#333;">
                    <div>
                        <b id="user-name" style="display:block;">User</b>
                        <span id="user-email" style="font-size:12px; color:var(--dim);">email@example.com</span>
                    </div>
                </div>
                
                <button onclick="auth.signOut()" style="width:100%; padding:12px; background:var(--error); color:white; border:none; border-radius:10px; font-weight:700;">LOG OUT</button>
                
                <div class="build-tag">
                    VERSION: 3.2.0-STABLE <br>
                    BUILD: 20260215_AUTH_MULTI
                </div>
            </div>
        </div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyCEdkitaytyO0ZHL-bbU0R1p_oy8E1RhbY",
            authDomain: "plannerapp-ff221.firebaseapp.com",
            projectId: "plannerapp-ff221",
            storageBucket: "plannerapp-ff221.appspot.com",
            messagingSenderId: "282165391993",
            appId: "1:282165391993:web:cd1b9e50b03a68edfb9aa8"
        };
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // AUTH LOGIC
        function login(providerName) {
            let provider;
            switch(providerName) {
                case 'google': provider = new firebase.auth.GoogleAuthProvider(); break;
                case 'apple': provider = new firebase.auth.OAuthProvider('apple.com'); break;
                case 'microsoft': provider = new firebase.auth.OAuthProvider('microsoft.com'); break;
                case 'discord': provider = new firebase.auth.OAuthProvider('oidc.discord'); break; // Note: Discord requires custom setup in Firebase
            }
            auth.signInWithPopup(provider).catch(err => alert(err.message));
        }

        function loginPhone() {
            const num = prompt("Enter phone number with country code (e.g. +1234567890):");
            if(!num) return;
            
            const verifier = new firebase.auth.RecaptchaVerifier('recaptcha-container', { size: 'invisible' });
            auth.signInWithPhoneNumber(num, verifier).then(result => {
                const code = prompt("Enter the 6-digit code sent to your phone:");
                return result.confirm(code);
            }).catch(err => alert(err.message));
        }

        auth.onAuthStateChanged(user => {
            if(user) {
                document.getElementById('login-screen').style.display = 'none';
                document.getElementById('app-shell').style.display = 'flex';
                document.getElementById('user-img').src = user.photoURL || '';
                document.getElementById('user-name').innerText = user.displayName || user.phoneNumber || 'User';
                document.getElementById('user-email').innerText = user.email || 'No email associated';
                sync(user.uid);
            } else {
                document.getElementById('login-screen').style.display = 'flex';
                document.getElementById('app-shell').style.display = 'none';
            }
        });

        // APP CORE
        let tasks = [];
        let activeTab = 'General';
        let agendas = [{id:'General'}];

        function sync(uid) {
            db.collection("tasks").where("uid", "==", uid).onSnapshot(snap => {
                tasks = snap.docs.map(d => ({id: d.id, ...d.data()}));
                render();
            });
        }

        function handleTaskSubmit() {
            const name = document.getElementById('t-input').value;
            const date = document.getElementById('d-input').value;
            if(!name || !date) return;
            db.collection("tasks").add({ name, date, category: activeTab, uid: auth.currentUser.uid });
            document.getElementById('t-input').value = '';
        }

        function render() {
            const main = document.getElementById('main-content');
            main.innerHTML = tasks.filter(t => t.category === activeTab).map(t => `
                <div class="card">
                    <div><b>${t.name}</b><br><small>${t.date}</small></div>
                    <button onclick="db.collection('tasks').doc('${t.id}').delete()" style="background:none; border:none; color:var(--error);">âœ•</button>
                </div>
            `).join('');
            
            document.getElementById('tab-bar').innerHTML = agendas.map(a => `
                <div class="tab-pill ${a.id === activeTab ? 'active' : ''}" onclick="activeTab='${a.id}'; render();">${a.id}</div>
            `).join('');
        }

        function openModal(id) { document.getElementById(id).style.display = 'flex'; }
        function closeModal() { document.querySelectorAll('.modal-overlay').forEach(m => m.style.display = 'none'); }
    </script>
</body>
</html>
